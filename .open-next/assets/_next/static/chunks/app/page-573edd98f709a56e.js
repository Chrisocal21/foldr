(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{33741:(e,t,s)=>{"use strict";s.d(t,{$5:()=>l,M3:()=>n,Vv:()=>d,iD:()=>a,qo:()=>g,ri:()=>c,tK:()=>m});let r="/api";function o(){return localStorage.getItem("foldr_auth_token")}function n(){return!!o()&&!!localStorage.getItem("foldr_user_id")}async function a(e,t){try{let s=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),o=await s.json();if(o.success&&o.token&&o.userId)return localStorage.setItem("foldr_auth_token",o.token),localStorage.setItem("foldr_user_id",o.userId),localStorage.setItem("foldr_user_email",e),{success:!0,userId:o.userId,token:o.token};return{success:!1,error:o.error||"Login failed"}}catch(e){return{success:!1,error:"Network error - working offline"}}}async function l(e,t,s){try{let o=await fetch("".concat(r,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,inviteCode:s})}),n=await o.json();if(n.success&&n.token&&n.userId)return localStorage.setItem("foldr_auth_token",n.token),localStorage.setItem("foldr_user_id",n.userId),localStorage.setItem("foldr_user_email",e),{success:!0,userId:n.userId,token:n.token};return{success:!1,error:n.error||"Signup failed"}}catch(e){return{success:!1,error:"Network error"}}}function c(){localStorage.removeItem("foldr_auth_token"),localStorage.removeItem("foldr_user_id"),localStorage.removeItem("foldr_user_email")}async function i(){let e=o();if(!e)return{success:!1,error:"Not logged in"};try{let t={trips:localStorage.getItem("foldr_trips"),blocks:localStorage.getItem("foldr_blocks"),todos:localStorage.getItem("foldr_todos"),packingItems:localStorage.getItem("foldr_packing_items"),expenses:localStorage.getItem("foldr_expenses"),settings:localStorage.getItem("foldr_settings")},s=await fetch("".concat(r,"/sync/push"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(t)}),o=await s.json();if(o.success)return localStorage.setItem("foldr_last_sync",new Date().toISOString()),{success:!0};return{success:!1,error:o.error||"Sync failed"}}catch(e){return{success:!1,error:"Network error - will sync when online"}}}async function u(){let e=o();if(!e)return{success:!1,error:"Not logged in"};try{let t=await fetch("".concat(r,"/sync/pull"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}),s=await t.json();if(s.success)return s.trips&&localStorage.setItem("foldr_trips",s.trips),s.blocks&&localStorage.setItem("foldr_blocks",s.blocks),s.todos&&localStorage.setItem("foldr_todos",s.todos),s.packingItems&&localStorage.setItem("foldr_packing_items",s.packingItems),s.expenses&&localStorage.setItem("foldr_expenses",s.expenses),s.settings&&localStorage.setItem("foldr_settings",s.settings),localStorage.setItem("foldr_last_sync",new Date().toISOString()),{success:!0};return{success:!1,error:s.error||"Sync failed"}}catch(e){return{success:!1,error:"Network error - working offline"}}}async function d(){let e=await u();return e.success||"Network error - working offline"===e.error?await i():e}function m(){return localStorage.getItem("foldr_last_sync")}function g(){return localStorage.getItem("foldr_user_email")}},35695:(e,t,s)=>{"use strict";var r=s(18999);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},41057:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var r=s(95155),o=s(12115),n=s(35695),a=s(6874),l=s.n(a),c=s(33741);function i(){return(0,r.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})})}function u(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),[s,a]=(0,o.useState)("login"),[u,d]=(0,o.useState)(""),[m,g]=(0,o.useState)(""),[h,p]=(0,o.useState)(""),[f,x]=(0,o.useState)(""),[b,j]=(0,o.useState)(!1),[w,k]=(0,o.useState)(""),[y,S]=(0,o.useState)(""),[v,N]=(0,o.useState)(!1),[_,I]=(0,o.useState)(!1),[C,L]=(0,o.useState)(!0);(0,o.useEffect)(()=>{I(!0),(0,c.M3)()?e.replace("/trips"):L(!1)},[e]),(0,o.useEffect)(()=>{let e=null==t?void 0:t.get("mode");"signup"===e?a("signup"):"reset"===e&&a("reset")},[t]);let P=async t=>{if(t.preventDefault(),k(""),S(""),N(!0),("signup"===s||"reset"===s)&&m!==h){k("Passwords do not match"),N(!1);return}try{if("reset"===s){let e=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,newPassword:m,inviteCode:f})}),t=await e.json();t.success?(S("Password reset successfully! You can now sign in."),g(""),p(""),x(""),setTimeout(()=>a("login"),2e3)):k(t.error||"Reset failed")}else{let t="login"===s?await (0,c.iD)(u,m):await (0,c.$5)(u,m,f);t.success?(await (0,c.Vv)(),e.push("/trips")):k(t.error||"Authentication failed")}}catch(e){k("Network error - please try again")}finally{N(!1)}};return!_||C?(0,r.jsx)(i,{}):(0,r.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-sm",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("img",{src:"/logos/logo.png",alt:"Foldr",className:"h-12 w-auto mx-auto mb-4",onError:e=>{let t=e.target;t.style.display="none",t.insertAdjacentHTML("afterend",'<span class="text-3xl font-bold" style="color: #6B9AE8">Foldr</span>')}}),(0,r.jsxs)("p",{className:"text-slate-400",children:["login"===s&&"Sign in to sync your trips","signup"===s&&"Create an account to sync your trips","reset"===s&&"Reset your password"]})]}),(0,r.jsxs)("form",{onSubmit:P,className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[w&&(0,r.jsx)("div",{className:"bg-red-500/20 border border-red-500/50 text-red-400 px-4 py-3 rounded-lg mb-4 text-sm",children:w}),y&&(0,r.jsx)("div",{className:"bg-green-500/20 border border-green-500/50 text-green-400 px-4 py-3 rounded-lg mb-4 text-sm",children:y}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Email"}),(0,r.jsx)("input",{type:"email",value:u,onChange:e=>d(e.target.value),required:!0,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"you@example.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"reset"===s?"New Password":"Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:b?"text":"password",value:m,onChange:e=>g(e.target.value),required:!0,minLength:6,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 pr-10 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"••••••••"}),(0,r.jsx)("button",{type:"button",onClick:()=>j(!b),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300",children:b?(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):(0,r.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),("signup"===s||"reset"===s)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"reset"===s?"Confirm New Password":"Confirm Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:b?"text":"password",value:h,onChange:e=>p(e.target.value),required:!0,minLength:6,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 pr-10 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"••••••••"}),(0,r.jsx)("button",{type:"button",onClick:()=>j(!b),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300",children:b?(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):(0,r.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Invite Code"}),(0,r.jsx)("input",{type:"text",value:f,onChange:e=>x(e.target.value),required:!0,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter invite code"})]})]})]}),(0,r.jsx)("button",{type:"submit",disabled:v,className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-600/50 text-white font-medium py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2",children:v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"login"===s&&"Signing in...","signup"===s&&"Creating account...","reset"===s&&"Resetting password..."]}):(0,r.jsxs)(r.Fragment,{children:["login"===s&&"Sign In","signup"===s&&"Create Account","reset"===s&&"Reset Password"]})})]}),(0,r.jsxs)("div",{className:"text-center mt-4 text-slate-400 text-sm space-y-2",children:["login"===s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:["Don't have an account?"," ",(0,r.jsx)("button",{onClick:()=>{a("signup"),k(""),S("")},className:"text-blue-400 hover:text-blue-300",children:"Sign up"})]}),(0,r.jsx)("p",{children:(0,r.jsx)("button",{onClick:()=>{a("reset"),k(""),S("")},className:"text-slate-500 hover:text-slate-400",children:"Forgot password?"})})]}),"signup"===s&&(0,r.jsxs)("p",{children:["Already have an account?"," ",(0,r.jsx)("button",{onClick:()=>{a("login"),k(""),S("")},className:"text-blue-400 hover:text-blue-300",children:"Sign in"})]}),"reset"===s&&(0,r.jsxs)("p",{children:["Remember your password?"," ",(0,r.jsx)("button",{onClick:()=>{a("login"),k(""),S("")},className:"text-blue-400 hover:text-blue-300",children:"Sign in"})]})]}),(0,r.jsx)("p",{className:"text-center mt-6",children:(0,r.jsx)(l(),{href:"/trips",className:"text-slate-500 hover:text-slate-400 text-sm",children:"Continue without account →"})})]})})}function d(){return(0,r.jsx)(o.Suspense,{fallback:(0,r.jsx)(i,{}),children:(0,r.jsx)(u,{})})}function m(){return(0,r.jsx)(d,{})}},78102:(e,t,s)=>{Promise.resolve().then(s.bind(s,41057))}},e=>{e.O(0,[874,441,964,358],()=>e(e.s=78102)),_N_E=e.O()}]);