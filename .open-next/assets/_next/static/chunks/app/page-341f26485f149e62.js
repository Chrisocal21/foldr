(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{33741:(e,t,s)=>{"use strict";s.d(t,{$5:()=>l,AF:()=>g,M3:()=>a,Vv:()=>h,iD:()=>n,qo:()=>x,qr:()=>d,ri:()=>i,tK:()=>f});let r="/api";function o(){return localStorage.getItem("foldr_auth_token")}function a(){return!!o()&&!!localStorage.getItem("foldr_user_id")}async function n(e,t){try{let s=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),o=await s.json();if(o.success&&o.token&&o.userId)return localStorage.setItem("foldr_auth_token",o.token),localStorage.setItem("foldr_user_id",o.userId),localStorage.setItem("foldr_user_email",e),{success:!0,userId:o.userId,token:o.token};return{success:!1,error:o.error||"Login failed"}}catch(e){return{success:!1,error:"Network error - working offline"}}}async function l(e,t,s){try{let o=await fetch("".concat(r,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,inviteCode:s})}),a=await o.json();if(a.success&&a.token&&a.userId)return localStorage.setItem("foldr_auth_token",a.token),localStorage.setItem("foldr_user_id",a.userId),localStorage.setItem("foldr_user_email",e),{success:!0,userId:a.userId,token:a.token};return{success:!1,error:a.error||"Signup failed"}}catch(e){return{success:!1,error:"Network error"}}}function i(){localStorage.removeItem("foldr_auth_token"),localStorage.removeItem("foldr_user_id"),localStorage.removeItem("foldr_user_email")}let c="foldr_sync_log";function d(){let e=localStorage.getItem(c);return e?JSON.parse(e):[]}function u(e){let t=d();t.unshift(e),t.length>10&&(t.length=10),localStorage.setItem(c,JSON.stringify(t))}async function g(){let e=o();if(!e)return{success:!1,error:"Not logged in"};try{var t,s,a,n,l;let o=localStorage.getItem("foldr_deleted_items"),i=o?JSON.parse(o):null,c=i?((null==(t=i.trips)?void 0:t.length)||0)+((null==(s=i.blocks)?void 0:s.length)||0)+((null==(a=i.todos)?void 0:a.length)||0)+((null==(n=i.packingItems)?void 0:n.length)||0)+((null==(l=i.expenses)?void 0:l.length)||0):0,d={trips:localStorage.getItem("foldr_trips"),blocks:localStorage.getItem("foldr_blocks"),todos:localStorage.getItem("foldr_todos"),packingItems:localStorage.getItem("foldr_packing_items"),expenses:localStorage.getItem("foldr_expenses"),settings:localStorage.getItem("foldr_settings"),deletedItems:i},g=await fetch("".concat(r,"/sync/push"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(d)}),m=await g.json();if(m.success)return localStorage.setItem("foldr_last_sync",new Date().toISOString()),localStorage.removeItem("foldr_deleted_items"),u({timestamp:new Date().toISOString(),action:"push",changes:{added:0,updated:0,deleted:c},success:!0}),{success:!0};return u({timestamp:new Date().toISOString(),action:"push",changes:{added:0,updated:0,deleted:0},success:!1,error:m.error}),{success:!1,error:m.error||"Sync failed"}}catch(e){return u({timestamp:new Date().toISOString(),action:"push",changes:{added:0,updated:0,deleted:0},success:!1,error:"Network error"}),{success:!1,error:"Network error - will sync when online"}}}function m(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=new Map,a=new Set(t.map(e=>e.id)),n=r?new Date(r).getTime():0;for(let e of t)s.has(e.id)||o.set(e.id,e);for(let t of e)if(!s.has(t.id))if(a.has(t.id)){let e=o.get(t.id);e&&(t.updatedAt?new Date(t.updatedAt).getTime():0)>(e.updatedAt?new Date(e.updatedAt).getTime():0)&&o.set(t.id,t)}else((t.createdAt?new Date(t.createdAt).getTime():t.updatedAt?new Date(t.updatedAt).getTime():0)>n||0===n)&&o.set(t.id,t);return Array.from(o.values())}async function p(){let e=o();if(!e)return{success:!1,error:"Not logged in"};try{let t=await fetch("".concat(r,"/sync/pull"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}),s=await t.json();if(s.success){let e=localStorage.getItem("foldr_last_sync"),t=localStorage.getItem("foldr_deleted_items"),r=t?JSON.parse(t):{trips:[],blocks:[],todos:[],packingItems:[],expenses:[]},o=JSON.parse(localStorage.getItem("foldr_trips")||"[]"),a=JSON.parse(localStorage.getItem("foldr_blocks")||"[]"),n=JSON.parse(localStorage.getItem("foldr_todos")||"[]"),l=JSON.parse(localStorage.getItem("foldr_packing_items")||"[]"),i=JSON.parse(localStorage.getItem("foldr_expenses")||"[]"),c=new Set(o.map(e=>e.id)),d=new Set(a.map(e=>e.id)),g=s.trips?JSON.parse(s.trips):[],p=s.blocks?JSON.parse(s.blocks):[],h=s.todos?JSON.parse(s.todos):[],f=s.packingItems?JSON.parse(s.packingItems):[],x=s.expenses?JSON.parse(s.expenses):[],S=new Set(g.map(e=>e.id)),w=new Set(p.map(e=>e.id)),b=m(o,g,new Set(r.trips),e),k=m(a,p,new Set(r.blocks),e),j=m(n,h,new Set(r.todos),e),y=m(l,f,new Set(r.packingItems),e),N=m(i,x,new Set(r.expenses),e),v=g.filter(e=>!c.has(e.id)).length+p.filter(e=>!d.has(e.id)).length,_=o.filter(e=>{var t;return!S.has(e.id)&&!(null==(t=r.trips)?void 0:t.includes(e.id))}).length+a.filter(e=>{var t;return!w.has(e.id)&&!(null==(t=r.blocks)?void 0:t.includes(e.id))}).length;return localStorage.setItem("foldr_trips",JSON.stringify(b)),localStorage.setItem("foldr_blocks",JSON.stringify(k)),localStorage.setItem("foldr_todos",JSON.stringify(j)),localStorage.setItem("foldr_packing_items",JSON.stringify(y)),localStorage.setItem("foldr_expenses",JSON.stringify(N)),s.settings&&localStorage.setItem("foldr_settings",s.settings),localStorage.setItem("foldr_last_sync",new Date().toISOString()),u({timestamp:new Date().toISOString(),action:"pull",changes:{added:v,updated:0,deleted:_},success:!0}),{success:!0,changes:{added:v,removed:_}}}return u({timestamp:new Date().toISOString(),action:"pull",changes:{added:0,updated:0,deleted:0},success:!1,error:s.error}),{success:!1,error:s.error||"Sync failed"}}catch(e){return u({timestamp:new Date().toISOString(),action:"pull",changes:{added:0,updated:0,deleted:0},success:!1,error:"Network error"}),{success:!1,error:"Network error - working offline"}}}async function h(){let e=await p();return e.success||"Network error - working offline"===e.error?await g():e}function f(){return localStorage.getItem("foldr_last_sync")}function x(){return localStorage.getItem("foldr_user_email")}},35695:(e,t,s)=>{"use strict";var r=s(18999);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},41057:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var r=s(95155),o=s(12115),a=s(35695),n=s(6874),l=s.n(n),i=s(33741);function c(){return(0,r.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})})}function d(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),[s,n]=(0,o.useState)("login"),[d,u]=(0,o.useState)(""),[g,m]=(0,o.useState)(""),[p,h]=(0,o.useState)(""),[f,x]=(0,o.useState)(""),[S,w]=(0,o.useState)(!1),[b,k]=(0,o.useState)(""),[j,y]=(0,o.useState)(""),[N,v]=(0,o.useState)(!1),[_,I]=(0,o.useState)(!1),[O,C]=(0,o.useState)(!0);(0,o.useEffect)(()=>{I(!0),(0,i.M3)()?e.replace("/trips"):C(!1)},[e]),(0,o.useEffect)(()=>{let e=null==t?void 0:t.get("mode");"signup"===e?n("signup"):"reset"===e&&n("reset")},[t]);let J=async t=>{if(t.preventDefault(),k(""),y(""),v(!0),("signup"===s||"reset"===s)&&g!==p){k("Passwords do not match"),v(!1);return}try{if("reset"===s){let e=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d,newPassword:g,inviteCode:f})}),t=await e.json();t.success?(y("Password reset successfully! You can now sign in."),m(""),h(""),x(""),setTimeout(()=>n("login"),2e3)):k(t.error||"Reset failed")}else{let t="login"===s?await (0,i.iD)(d,g):await (0,i.$5)(d,g,f);t.success?(await (0,i.Vv)(),e.push("/trips")):k(t.error||"Authentication failed")}}catch(e){k("Network error - please try again")}finally{v(!1)}};return!_||O?(0,r.jsx)(c,{}):(0,r.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-sm",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("img",{src:"/logos/logo.png",alt:"TripFldr",className:"h-12 w-auto mx-auto mb-4",onError:e=>{let t=e.target;t.style.display="none",t.insertAdjacentHTML("afterend",'<span class="text-3xl font-bold" style="color: #6B9AE8">TripFldr</span>')}}),(0,r.jsxs)("p",{className:"text-slate-400",children:["login"===s&&"Sign in to sync your trips","signup"===s&&"Create an account to sync your trips","reset"===s&&"Reset your password"]})]}),(0,r.jsxs)("form",{onSubmit:J,className:"bg-slate-800 rounded-xl p-6 border border-slate-700",children:[b&&(0,r.jsx)("div",{className:"bg-red-500/20 border border-red-500/50 text-red-400 px-4 py-3 rounded-lg mb-4 text-sm",children:b}),j&&(0,r.jsx)("div",{className:"bg-green-500/20 border border-green-500/50 text-green-400 px-4 py-3 rounded-lg mb-4 text-sm",children:j}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Email"}),(0,r.jsx)("input",{type:"email",value:d,onChange:e=>u(e.target.value),required:!0,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"you@example.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"reset"===s?"New Password":"Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:S?"text":"password",value:g,onChange:e=>m(e.target.value),required:!0,minLength:6,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 pr-10 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"••••••••"}),(0,r.jsx)("button",{type:"button",onClick:()=>w(!S),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300",children:S?(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):(0,r.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),("signup"===s||"reset"===s)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"reset"===s?"Confirm New Password":"Confirm Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:S?"text":"password",value:p,onChange:e=>h(e.target.value),required:!0,minLength:6,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 pr-10 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"••••••••"}),(0,r.jsx)("button",{type:"button",onClick:()=>w(!S),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300",children:S?(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):(0,r.jsxs)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Invite Code"}),(0,r.jsx)("input",{type:"text",value:f,onChange:e=>x(e.target.value),required:!0,className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter invite code"})]})]})]}),(0,r.jsx)("button",{type:"submit",disabled:N,className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-600/50 text-white font-medium py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2",children:N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"login"===s&&"Signing in...","signup"===s&&"Creating account...","reset"===s&&"Resetting password..."]}):(0,r.jsxs)(r.Fragment,{children:["login"===s&&"Sign In","signup"===s&&"Create Account","reset"===s&&"Reset Password"]})})]}),(0,r.jsxs)("div",{className:"text-center mt-4 text-slate-400 text-sm space-y-2",children:["login"===s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:["Don't have an account?"," ",(0,r.jsx)("button",{onClick:()=>{n("signup"),k(""),y("")},className:"text-blue-400 hover:text-blue-300",children:"Sign up"})]}),(0,r.jsx)("p",{children:(0,r.jsx)("button",{onClick:()=>{n("reset"),k(""),y("")},className:"text-slate-500 hover:text-slate-400",children:"Forgot password?"})})]}),"signup"===s&&(0,r.jsxs)("p",{children:["Already have an account?"," ",(0,r.jsx)("button",{onClick:()=>{n("login"),k(""),y("")},className:"text-blue-400 hover:text-blue-300",children:"Sign in"})]}),"reset"===s&&(0,r.jsxs)("p",{children:["Remember your password?"," ",(0,r.jsx)("button",{onClick:()=>{n("login"),k(""),y("")},className:"text-blue-400 hover:text-blue-300",children:"Sign in"})]})]}),(0,r.jsx)("p",{className:"text-center mt-6",children:(0,r.jsx)(l(),{href:"/trips",className:"text-slate-500 hover:text-slate-400 text-sm",children:"Continue without account →"})})]})})}function u(){return(0,r.jsx)(o.Suspense,{fallback:(0,r.jsx)(c,{}),children:(0,r.jsx)(d,{})})}function g(){return(0,r.jsx)(u,{})}},78102:(e,t,s)=>{Promise.resolve().then(s.bind(s,41057))}},e=>{e.O(0,[874,441,964,358],()=>e(e.s=78102)),_N_E=e.O()}]);